<!doctype html>
<html lang="en" data-bs-theme="auto" id="html-root">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Employee Management</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Oswald:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- FullCalendar -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.js"></script>

    <!-- Custom CSS -->
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body>
<div class="container">

    <header class="mb-4 py-3 border-bottom d-flex align-items-center">
        <div>
            <div class="miami-title">Employee Management</div>
            <div class="miami-subtitle">by Austin Shaw</div>
        </div>
    </header>

    <!-- Employee Schedule -->
    <div class="card mb-4 shadow-sm p-3">
        <h2 class="h5 mb-3">Employee Schedule</h2>
        <div id="calendar"></div>
    </div>

    <!-- Flash messages -->
    {% with msgs = get_flashed_messages(with_categories=True) %}
    {% if msgs %}
        <div class="mb-3">
            {% for category, m in msgs %}
                {% set bs = 'success' if category=='success' else 'danger' %}
                <div class="alert alert-{{ bs }} alert-dismissible fade show" role="alert">
                    {{ m }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        </div>
    {% endif %}
    {% endwith %}

    <!-- Add employee form -->
    <div class="card shadow-sm form-card mb-4">
        <div class="card-body">
            <h2 class="h5 mb-3">Add Employee</h2>
            <form method="POST" action="{{ url_for('index') }}" class="row g-3">
                <input type="hidden" name="action" value="add">
                <div class="col-md-3">
                    <label for="employee_id" class="form-label">Employee ID</label>
                    <input class="form-control" id="employee_id" name="employee_id" required>
                </div>
                <div class="col-md-3">
                    <label for="name" class="form-label">Name</label>
                    <input class="form-control" id="name" name="name" required>
                </div>
                <div class="col-md-3">
                    <label for="phone" class="form-label">Phone</label>
                    <input class="form-control" id="phone" name="phone" required
                           pattern="^[0-9()+\-\\s]+$" title="Digits, spaces, (), - and + only">
                </div>
                <div class="col-md-3">
                    <label for="hourly_rate" class="form-label">Hourly Rate</label>
                    <input type="number" step="0.01" class="form-control" id="hourly_rate" name="hourly_rate" required>
                </div>
                <div class="col-12">
                    <button class="btn btn-primary" type="submit">Add Employee</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Employee table and pagination (same as previous setup) -->
    <!-- ... keep your table and pagination code here ... -->

</div>

<!-- Edit Modal (same as previous) -->

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="{{ url_for('static', filename='js/app.js') }}"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        selectable: true,
        editable: true,
        events: '/api/schedules',
        select: function(info) {
            let employeeId = prompt("Enter Employee ID for " + info.startStr);
            let startTime = prompt("Start time (HH:MM)");
            let endTime = prompt("End time (HH:MM)");

            if(employeeId && startTime && endTime){
                fetch('/api/schedules', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        employee_id: employeeId,
                        date: info.startStr,
                        start_time: startTime,
                        end_time: endTime
                    })
                }).then(() => calendar.refetchEvents());
            }
        }
    });
    calendar.render();
});
</script>

</body>
</html>
